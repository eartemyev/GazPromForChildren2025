@if (Data != null && RaceAthletes != null)
{
    for (var currentRace = 1; currentRace <=6; currentRace++)
    {
        <div class="card">
        <div class="card-header bg-tertiary text-bg-secondary">
            <h5 class="card-title mb-0">Гонка @currentRace</h5>
        </div>
        <table class="table table-striped table-hover table-bordered mb-0">
            <thead>
                <tr class="">
                    <th scope="col">#</th>
                    <th scope="col">Карт</th>
                    <th scope="col">Пилот</th>
                    <th scope="col">Очки</th>
                    <th colspan="2" scope="col">Время</th>
                    <th colspan="2" scope="col">Стаб</th>
                    <th scope="col">Круг 1</th>
                    <th scope="col">Круг 2</th>
                    <th scope="col">Круг 3</th>
                    <th scope="col">Круг 4</th>
                    <th scope="col">Круг 5</th>
                    <th scope="col">Круг 6</th>
                    <th scope="col">Круг 7</th>
                    <th scope="col">Круг 8</th>
                    <th scope="col">Круг 9</th>
                    <th scope="col">Круг 10</th>
                </tr>
            </thead>
            <tbody>
                @{ var position = 1;}
                @foreach (var currentAthlete in RaceAthletes.Where(e => e.RaceNumber == currentRace).OrderByDescending(e => e.TotalPoints).ThenByDescending(e => e.BestTimePoints))
                {
                    <tr>
                        <td>@position</td>
                        <td>@currentAthlete.CarNumber</td>
                        <td>@currentAthlete.AthleteName</td>
                        <td>@currentAthlete.TotalPoints = @currentAthlete.BestTimePoints + @currentAthlete.DeltaTimePoints</td>
                        <td>@currentAthlete.Time1</td>
                        <td>@currentAthlete.BestTimePosition</td>
                        <td>@currentAthlete.TimeDelta</td>
                        <td>@currentAthlete.DeltaTimePosition</td>
                        @for (var currentLap = 1; currentLap <= 10; currentLap++)
                        {
                            var item = Data.FirstOrDefault(e =>
                                e.RaceNumber == currentRace 
                                && e.CarNumber == currentAthlete.CarNumber
                                && e.LapNumber == currentLap 
                            );
                            if (item == null)
                            {
                                <td> - </td>
                            }
                            else
                            {
                                var style = item.BestLap switch
                                {
                                    1 => "background-color: rgb(0 255 0 / 0.5); ",
                                    2 => "background-color: rgb(0 255 0 / 0.25); ",
                                    3 => "background-color: rgb(0 255 0 / 0.1); ",
                                    _ => ""
                                };

                                <td style="@style">@item.Time</td>
                            }
                        }
                    </tr>
                    position++;
                }
            </tbody>
        </table>
        </div>
        <br/>
    }
}